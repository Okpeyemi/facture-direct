<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>Facture {{facture.numero}}</title>
  <style>
    * { box-sizing: border-box; }
    @page { size: A4; margin: 0; }
    body { 
      font-family: 'Helvetica Neue', Arial, sans-serif; 
      font-size: 10pt; 
      margin: 0; 
      padding: 0; 
      color: #333;
      width: 210mm;
      min-height: 297mm;
    }
    .container { 
      width: 100%; 
      padding: 15mm 15mm 20mm 15mm;
    }
    .header { 
      display: table;
      width: 100%;
      margin-bottom: 25px; 
    }
    .header-left, .header-right {
      display: table-cell;
      vertical-align: top;
    }
    .header-left { width: 50%; }
    .header-right { width: 50%; text-align: right; }
    .info { line-height: 1.5; font-size: 9pt; }
    .bold { font-weight: bold; font-size: 11pt; }
    .title { font-size: 20pt; font-weight: bold; color: #2c3e50; margin-bottom: 8px; }
    .statut { 
      display: inline-block; 
      padding: 4px 12px; 
      border-radius: 4px; 
      font-size: 9pt; 
      font-weight: bold;
    }
    .statut-brouillon { background: #f39c12; color: white; }
    .statut-validee { background: #27ae60; color: white; }
    table { width: 100%; border-collapse: collapse; margin: 20px 0; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: left; font-size: 9pt; }
    th { background-color: #2c3e50; color: white; font-size: 9pt; }
    td.description { max-width: 200px; word-wrap: break-word; }
    .right { text-align: right; white-space: nowrap; }
    .total-section { margin-top: 20px; width: 100%; }
    .total-table { width: 250px; margin-left: auto; border-collapse: collapse; }
    .total-table td { border: none; padding: 5px 10px; font-size: 10pt; }
    .total-table .label { text-align: right; }
    .total-table .value { text-align: right; font-weight: bold; white-space: nowrap; }
    .total-table .grand-total td { 
      font-size: 12pt; 
      background: #ecf0f1; 
      padding: 10px;
    }
    .footer { margin-top: 40px; font-size: 8pt; color: #666; line-height: 1.4; }
    .mentions { 
      margin-top: 25px; 
      padding: 12px; 
      background: #f9f9f9; 
      border-left: 3px solid #2c3e50;
      font-size: 9pt;
    }
    .iban { margin-top: 10px; font-size: 9pt; }
    .client-box {
      margin-bottom: 20px; 
      padding: 12px; 
      background: #f5f5f5;
      font-size: 9pt;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="header-left info">
        <div class="bold">{{entreprise.nom}}</div>
        {{#if entreprise.adresse}}<div>{{entreprise.adresse}}</div>{{/if}}
        {{#if entreprise.codePostal}}<div>{{entreprise.codePostal}} {{entreprise.ville}}</div>{{/if}}
        {{#if entreprise.siren}}<div>SIREN : {{entreprise.siren}}</div>{{/if}}
        {{#if entreprise.tvaIntra}}<div>TVA Intra : {{entreprise.tvaIntra}}</div>{{/if}}
      </div>
      <div class="header-right info">
        <div class="title">FACTURE</div>
        <div class="bold">N° {{facture.numero}}</div>
        <div>Date : {{formatDate facture.dateEmission}}</div>
        <div style="margin-top: 8px;">
          <span class="statut {{#if facture.estValidee}}statut-validee{{else}}statut-brouillon{{/if}}">
            {{#if facture.estValidee}}VALIDÉE{{else}}BROUILLON{{/if}}
          </span>
        </div>
      </div>
    </div>

    <div class="client-box">
      <strong>Facturé à :</strong><br>
      <div class="bold">{{client.nom}}</div>
      {{#if client.adresse}}<div>{{client.adresse}}</div>{{/if}}
      {{#if client.siren}}<div>SIREN : {{client.siren}}</div>{{/if}}
      {{#if client.tvaIntra}}<div>TVA Intra : {{client.tvaIntra}}</div>{{/if}}
    </div>

    <table>
      <thead>
        <tr>
          <th style="width: 45%;">Description</th>
          <th class="right" style="width: 10%;">Qté</th>
          <th class="right" style="width: 15%;">PU HT</th>
          <th class="right" style="width: 10%;">TVA</th>
          <th class="right" style="width: 20%;">Total HT</th>
        </tr>
      </thead>
      <tbody>
        {{#each facture.lignes}}
        <tr>
          <td class="description">{{this.description}}</td>
          <td class="right">{{this.quantite}}</td>
          <td class="right">{{formatMoney this.prixUnitaireHT}} €</td>
          <td class="right">{{this.tauxTVA}}%</td>
          <td class="right">{{formatMoney (multiply this.quantite this.prixUnitaireHT)}} €</td>
        </tr>
        {{/each}}
      </tbody>
    </table>

    <div class="total-section">
      <table class="total-table">
        <tr>
          <td class="label">Total HT :</td>
          <td class="value">{{formatMoney facture.totalHT}} €</td>
        </tr>
        <tr>
          <td class="label">TVA ({{facture.tauxTVA}}%) :</td>
          <td class="value">{{formatMoney facture.totalTVA}} €</td>
        </tr>
        <tr class="grand-total">
          <td class="label">Total TTC :</td>
          <td class="value">{{formatMoney facture.totalTTC}} €</td>
        </tr>
      </table>
    </div>

    <div class="mentions">
      <strong>Conditions de paiement :</strong> {{facture.conditionsPaiement}}<br><br>
      {{#if entreprise.iban}}
      <div class="iban">
        <strong>Coordonnées bancaires :</strong><br>
        IBAN : {{entreprise.iban}}<br>
        {{#if entreprise.bic}}BIC : {{entreprise.bic}}{{/if}}
      </div>
      {{/if}}
    </div>

    <div class="footer">
      {{#if entreprise.mentionTVALegale}}
        {{entreprise.mentionTVALegale}}
      {{else}}
        {{#if (eq entreprise.regimeTVA "FRANCHISE_BASE")}}
          TVA non applicable, art. 293 B du CGI
        {{/if}}
      {{/if}}
      <br><br>
      {{#if entreprise.mentionsLegales}}
        {{entreprise.mentionsLegales}}
      {{/if}}
      <br><br>
      <em>Document généré par FactureDirect</em>
    </div>
  </div>
</body>
</html>
